(function(){angular.module("ngLuminateUtils",[]).constant("APP_INFO",{version:"0.4.0"}),angular.module("ngLuminateUtils").provider("$luminateUtilsConfig",function(){var e;(e=this).setPath=function(t){return null==t&&(t={}),angular.isString(t.nonsecure||!angular.isString(t.secure))?(e.path={nonsecure:t.nonsecure,secure:t.secure},e):new Error("You must specify both a nonsecure and secure path.")},e.setKey=function(t){return angular.isString(t)?(e.apiKey=t,e):new Error("API Key must be a string but was "+typeof t)},e.setLocale=function(t){return angular.isString(t)?("en_US"!==t&&"es_US"!==t&&"en_CA"!==t&&"fr_CA"!==t&&"en_GB"!==t&&"en_AU"!==t||(e.locale=t),e):new Error("Locale must be a string but was "+typeof t)},e.setDefaultRequestData=function(t){return angular.isString(t)?e.defaultRequestData=t:new Error("Request data must be a string but was "+typeof t),e},e.$get=function(){return e}}),angular.module("ngLuminateUtils").factory("$luminateMessageCatalog",["$q","$luminateUtilsConfig","$luminateRequestHandler","$luminateRest",function(e,t,n,a){return{get:function(r){var s,u,i,o,l,g,c;return s=this,i=t.locale||"default",angular.isString(r)||angular.isArray(r)?(angular.isArray(r)||(r=[r]),u={},g=0,angular.forEach(r,function(e){var t,a,r;return 2!==(r=e.split(":")).length?new Error("Invalid Message Catalog bundle/key pair "+e):(t=n.sanitizeString(r[0],!0,!0),a=n.sanitizeString(r[1],!0,!0),u[t]||(u[t]={},g++),u[t].requestedKeys||(u[t].requestedKeys=[]),u[t].requestedKeys.push(a),u[t].newKeys||(u[t].newKeys=[]),s.messageCatalogCache||(s.messageCatalogCache={}),s.messageCatalogCache[i]||(s.messageCatalogCache[i]={}),s.messageCatalogCache[i][t]||(s.messageCatalogCache[i][t]={}),angular.isString(s.messageCatalogCache[i][t][a])?void 0:u[t].newKeys.push(a))}),0===u.length?n.rejectInvalidRequest("No Message Catalog bundles defined."):(o=e.defer(),l=0,c={},angular.forEach(u,function(e,t){return c[t]={},angular.forEach(e.requestedKeys,function(e){if(s.messageCatalogCache[i][t][e])return c[t][e]=s.messageCatalogCache[i][t][e]}),0!==e.newKeys.length?a.request({api:"content",data:"method=getMessageBundle&bundle="+t+"&keys="+e.newKeys.join(","),requiresAuth:!0}).then(function(n){var a,r;if((a=null!=(r=n.data.getMessageBundleResponse)?r.values:void 0)?(angular.isArray(a)||(a=[a]),angular.forEach(a,function(e){var n;return 0===(n=e.value).indexOf("Message not found for key: ")&&(n=""),s.messageCatalogCache[i][t][e.key]=n,c[t][e.key]=n})):angular.forEach(e.newKeys,function(e){return s.messageCatalogCache[i][t][e]="",c[t][e]=""}),++l===g)return o.resolve(c)}):++l===g?o.resolve(c):void 0}),o.promise)):n.rejectInvalidRequest("Message Catalog entries must be a string or array but was "+typeof r)},flushCache:function(){return _this.messageCatalogCache={},_this}}}]),angular.module("ngLuminateUtils").factory("$luminateRequestHandler",["$q",function(e){return{sanitizeString:function(e,t,n){var a;return a=e,n||(a=angular.element("<div>"+a+"</div>").text()),t||(a=a.replace(/\[\[/g,"").replace(/\]\]/g,"").replace(/::/g,"")),a},rejectInvalidRequest:function(t){var n;return null==t&&(t="Invalid request."),(n=e.defer()).reject(t),n.promise}}}]),angular.module("ngLuminateUtils").factory("$luminateRest",["$http","$q","$timeout","APP_INFO","$luminateUtilsConfig","$luminateRequestHandler",function(e,t,n,a,r,s){return{getAuthToken:function(e,n){var a,r;return!(a=this).authToken||e?(a.authTokenPending=!0,r="method=getLoginUrl",a.request({api:"cons",data:r}).then(function(e){var n,r,s;return a.routingId=null!=(n=e.data.getLoginUrlResponse)?n.routing_id:void 0,a.jsessionId=null!=(r=e.data.getLoginUrlResponse)?r.JSESSIONID:void 0,a.authToken=(null!=(s=e.data.getLoginUrlResponse)?s.token:void 0)||"",a.authTokenPending=!1,t.resolve(a.authToken)})):(a.authTokenPending=!1,t.resolve(a.authToken))},request:function(t){var u,i,o,l,g,c,d,f,m,h,p,v;return null==t&&(t={}),u=this,p=t,i=p.api,f=p.data,h=p.requiresAuth,v=p.useHTTP,"multipart/form-data"!==(null!=(o=p.contentType)?o.split(";")[0]:void 0)&&(o="application/x-www-form-urlencoded"),o+="; charset=UTF-8",r.path.nonsecure&&r.path.secure?r.apiKey?angular.isString(i)?("addressbook"!==(d=i.toLowerCase())&&"advocacy"!==d&&"cons"!==d&&"content"!==d&&"datasync"!==d&&"donation"!==d&&"group"!==d&&"orgevent"!==d&&"recurring"!==d&&"survey"!==d&&"teamraiser"!==d||(i=(i="CR"+i.toLowerCase().charAt(0).toUpperCase()+i.toLowerCase().slice(1).toLowerCase()+"API").replace("Addressbook","AddressBook").replace("Datasync","DataSync").replace("Orgevent","OrgEvent")),"CRAddressBookAPI"!==i&&"CRAdvocacyAPI"!==i&&"CRConsAPI"!==i&&"CRContentAPI"!==i&&"CRDataSyncAPI"!==i&&"CRDonationAPI"!==i&&"CRGroupAPI"!==i&&"CROrgEventAPI"!==i&&"CRRecurringAPI"!==i&&"CRSurveyAPI"!==i&&"CRTeamraiserAPI"!==i?s.rejectInvalidRequest("Invalid API servlet "+i):angular.isString(f)?(f="v=1.0&response_format=json&suppress_response_codes=true&"+f+"&api_key="+r.apiKey,l=-1!==f.indexOf("&method=getLoginUrl&"),g=-1!==f.indexOf("&method=login&"),c=-1!==f.indexOf("&method=logout&"),l||u.authToken?("CRDonation"!==i&&"CRTeamraiserAPI"!==i||(v=!1),m=v?r.path.nonsecure:r.path.secure,m+=i,u.routingId&&(m+=";jsessionid="+u.routingId),r.locale&&(f+="&s_locale="+r.locale),r.defaultRequestData&&(f+="&"+r.defaultRequestData),u.jsessionId&&(f+="&JSESSIONID="+u.jsessionId),h&&(f+="&auth="+u.authToken),(null!=a?a.version:void 0)&&(f+="&ng_luminate_utils="+a.version),f+="&ts="+(new Date).getTime(),e({method:"POST",url:m,data:f,headers:{"Content-Type":o},withCredentials:!0}).then(function(e){var t;return t=e,g||c?u.getAuthToken(!0,v).then(function(){return t}):t})):u.authTokenPending?n(function(){return u.request(t)},500):u.getAuthToken(!1,v).then(function(){return u.request(t)})):s.rejectInvalidRequest("Request data must be a string but was "+typeof f)):s.rejectInvalidRequest("API servlet must be a string but was "+typeof i):s.rejectInvalidRequest("You must specify both an API Key."):s.rejectInvalidRequest("You must specify both a nonsecure and secure path.")}}}]),angular.module("ngLuminateUtils").factory("$luminateSessionVar",["$q","$luminateRequestHandler","$luminateTemplateTag",function(e,t,n){return{get:function(e){var a;return angular.isString(e)?(e=t.sanitizeString(e,!0),a="",a=0===e.indexOf("[[")&&e.lastIndexOf("]]")===e.length-2?"[[E80:"+e+"]]":"[[S80:"+e+"]]",n.parse(a).then(function(e){return t.sanitizeString(e,!0)})):t.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)},set:function(e,a){return null==a&&(a=""),angular.isString(e)?!angular.isString(a)&&isNaN(a)?t.rejectInvalidRequest("Session variable value must be a string or number but was "+typeof a):(e=t.sanitizeString(e,!0,!0),a=t.sanitizeString(a,!0),n.parse("[[U1:"+e+"="+a+"]]")):t.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)}}}]),angular.module("ngLuminateUtils").factory("$luminateTemplateTag",["$q","$luminateRequestHandler","$luminateRest",function(e,t,n){return{parse:function(a){var r;return null==a&&(a=""),angular.isString(a)?""===a?((r=e.defer()).resolve(""),r.promise):(a=t.sanitizeString(a,!0),n.request({api:"content",data:"method=getTagInfo&content="+a,requiresAuth:!0}).then(function(t){var n,a;return n=(null!=(a=t.data.getTagInfoResponse)?a.preview:void 0)||"",e.resolve(n)})):t.rejectInvalidRequest("Template tag must be a string but was "+typeof a)}}}]),angular.module("ngLuminateUtils").directive("luminateReusable",function(){return{scope:{pagename:"="},template:'<div ng-bind-html="reusableContent"></div>',replace:!0,controller:["$scope","$sce","$luminateRequestHandler","$luminateTemplateTag",function(e,t,n,a){var r;return(r=function(){var r,s;return r=e.pagename,angular.isString(r)?(r=n.sanitizeString(r,!0),s="",s=0===r.indexOf("[[")&&r.lastIndexOf("]]")===r.length-2?"[[E51:"+r+"]]":"[[S51:"+r+"]]",a.parse(s).then(function(n){return e.reusableContent=t.trustAsHtml(n)})):n.rejectInvalidRequest("Pagename must be a string but was "+typeof r)})(),e.$watch("pagename",function(e,t){if(e!==t)return r()})}]}})}).call(this);