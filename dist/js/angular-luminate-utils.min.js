(function(){angular.module("ngLuminateUtils",[]).constant("APP_INFO",{version:"0.1.0"}),angular.module("ngLuminateUtils").provider("$luminateUtilsConfig",function(){var e;(e=this).setPath=function(n){return n.nonsecure&&n.secure?(e.path={nonsecure:n.nonsecure,secure:n.secure},e):new Error("You must specify both a nonsecure and secure path.")},e.setDefaultRequestData=function(n){return e.defaultRequestData=n,e},e.setKey=function(n){return n?(e.apiKey=n,e):new Error("You must specify an API Key.")},e.$get=function(){return e}}),angular.module("ngLuminateUtils").factory("$luminateRest",["$http","$q","$timeout","APP_INFO","$luminateUtilsConfig",function(e,n,t,o,r){return{getAuthToken:function(e){var t,o;return!(t=this).authToken||e?(t.authTokenPending=!0,o="method=getLoginUrl",t.nonce&&(o+="&NONCE_TOKEN="+t.nonce,t.nonce=null),t.request("cons",o).then(function(e){var o,r,u;return t.routingId=null!=(o=e.data.getLoginUrlResponse)?o.routing_id:void 0,t.jsessionId=null!=(r=e.data.getLoginUrlResponse)?r.JSESSIONID:void 0,t.authToken=(null!=(u=e.data.getLoginUrlResponse)?u.token:void 0)||"",t.authTokenPending=!1,n.resolve(t.authToken)})):(t.authTokenPending=!1,n.resolve(t.authToken))},request:function(n,u,a,s){var i,l,c,d,g,f,h;return null==s&&(s=!0),l=this,n?("addressbook"!==(f=n.toLowerCase())&&"advocacy"!==f&&"cons"!==f&&"content"!==f&&"datasync"!==f&&"donation"!==f&&"group"!==f&&"orgevent"!==f&&"recurring"!==f&&"survey"!==f&&"teamraiser"!==f||(n="CR"+n.toLowerCase().charAt(0).toUpperCase()+n.toLowerCase().slice(1).toLowerCase()+"API",n=n.replace("Addressbook","AddressBook").replace("Datasync","DataSync").replace("Orgevent","OrgEvent")),"CRAddressBookAPI"!==n&&"CRAdvocacyAPI"!==n&&"CRConsAPI"!==n&&"CRContentAPI"!==n&&"CRDataSyncAPI"!==n&&"CRDonationAPI"!==n&&"CRGroupAPI"!==n&&"CROrgEventAPI"!==n&&"CRRecurringAPI"!==n&&"CRSurveyAPI"!==n&&"CRTeamraiserAPI"!==n?new Error("Invalid API servlet."):u?(i="v=1.0&response_format=json&suppress_response_codes=true&"+u+"&api_key="+r.apiKey,c=-1!==i.indexOf("&method=getLoginUrl&"),d=-1!==i.indexOf("&method=login&"),g=-1!==i.indexOf("&method=logout&"),c||l.authToken?("CRDonation"!==n&&"CRTeamraiserAPI"!==n||(s=!0),h=s?r.path.secure:r.path.nonsecure,h+=n,l.routingId&&""!==l.routingId&&(h+=";"+l.routingId),a&&(i+="&auth="+l.authToken),l.jsessionId&&(i+="&JSESSIONID="+l.jsessionId),r.defaultRequestData&&(i+="&"+r.defaultRequestData),(null!=o?o.version:void 0)&&(i+="&ng_luminate_utils="+o.version),e({method:"POST",url:h,data:i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0}).then(function(e){var n,t;return n=e,d||g?(d&&(l.nonce=null!=(t=n.loginResponse)?t.nonce:void 0),l.getAuthToken(!0).then(function(){return n})):n})):l.authTokenPending?t(function(){return l.request(n,u,a)},500):l.getAuthToken().then(function(){return l.request(n,u,a)})):new Error("You must specify request data.")):new Error("You must specify an API servlet.")}}}]),angular.module("ngLuminateUtils").factory("$luminateSessionVar",["$q","$luminateTemplateTag",function(e,n){return{get:function(e){return n.parse("[[S80:"+e+"]]")},set:function(e,t){return n.parse("[[U1:"+e+"="+t+"]]")}}}]),angular.module("ngLuminateUtils").factory("$luminateTemplateTag",["$q","$luminateRest",function(e,n){return{parse:function(t){var o;return t?n.request("content","method=getTagInfo&content="+t,!0).then(function(n){var t,o;return t=(null!=(o=n.data.getTagInfoResponse)?o.preview:void 0)||"",e.resolve(t)}):((o=e.defer()).resolve(""),o.promise)}}}])}).call(this);