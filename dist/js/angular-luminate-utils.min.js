(function(){angular.module("ngLuminateUtils",[]).constant("APP_INFO",{version:"0.5.0"}),angular.module("ngLuminateUtils").provider("$luminateUtilsConfig",function(){var e;(e=this).setPath=function(n){var t,a;return null==n&&(n={}),angular.isString(n.nonsecure||!angular.isString(n.secure))?(n.nonsecure=n.nonsecure.toLowerCase(),n.secure=n.secure.toLowerCase(),t=n.nonsecure.indexOf("/site/")===n.nonsecure.length-6||n.nonsecure.indexOf("/admin/")!==n.nonsecure.length-6,a=n.secure.indexOf("/site/")===n.secure.length-7||n.secure.indexOf("/admin/")!==n.secure.length-7,t&&a?e.path={nonsecure:n.nonsecure,secure:n.secure}:(t||new Error("Invalid nonsecure path."),a||new Error("Invalid secure path."))):new Error("You must specify both a nonsecure and secure path."),e},e.setKey=function(n){return angular.isString(n)?e.apiKey=n:new Error("API Key must be a string but was "+typeof n),e},e.setLocale=function(n){return angular.isString(n)?"en_US"!==n&&"es_US"!==n&&"en_CA"!==n&&"fr_CA"!==n&&"en_GB"!==n&&"en_AU"!==n||(e.locale=n):new Error("Locale must be a string but was "+typeof n),e},e.setDefaultRequestData=function(n){return angular.isString(n)?e.defaultRequestData=n:new Error("Request data must be a string but was "+typeof n),e},e.$get=function(){return e}}),angular.module("ngLuminateUtils").factory("$luminateMessageCatalog",["$q","$luminateUtilsConfig","$luminateRequestHandler","$luminateRest",function(e,n,t,a){return{get:function(r){var s,u,i,o,l,g,c;return s=this,i=n.locale||"default",angular.isString(r)||angular.isArray(r)?(angular.isArray(r)||(r=[r]),u={},g=0,angular.forEach(r,function(e){var n,a,r;return 2!==(r=e.split(":")).length?new Error("Invalid Message Catalog bundle/key pair "+e):(n=t.sanitizeString(r[0],!0,!0),a=t.sanitizeString(r[1],!0,!0),u[n]||(u[n]={},g++),u[n].requestedKeys||(u[n].requestedKeys=[]),u[n].requestedKeys.push(a),u[n].newKeys||(u[n].newKeys=[]),s.messageCatalogCache||(s.messageCatalogCache={}),s.messageCatalogCache[i]||(s.messageCatalogCache[i]={}),s.messageCatalogCache[i][n]||(s.messageCatalogCache[i][n]={}),angular.isString(s.messageCatalogCache[i][n][a])?void 0:u[n].newKeys.push(a))}),0===u.length?t.rejectInvalidRequest("No Message Catalog bundles defined."):(o=e.defer(),l=0,c={},angular.forEach(u,function(e,n){return c[n]={},angular.forEach(e.requestedKeys,function(e){if(s.messageCatalogCache[i][n][e])return c[n][e]=s.messageCatalogCache[i][n][e]}),0!==e.newKeys.length?a.request({api:"content",data:"method=getMessageBundle&bundle="+n+"&keys="+e.newKeys.join(","),requiresAuth:!0}).then(function(t){var a,r;if((a=null!=(r=t.data.getMessageBundleResponse)?r.values:void 0)?(angular.isArray(a)||(a=[a]),angular.forEach(a,function(e){var t;return 0===(t=e.value).indexOf("Message not found for key: ")&&(t=""),s.messageCatalogCache[i][n][e.key]=t,c[n][e.key]=t})):angular.forEach(e.newKeys,function(e){return s.messageCatalogCache[i][n][e]="",c[n][e]=""}),++l===g)return o.resolve(c)}):++l===g?o.resolve(c):void 0}),o.promise)):t.rejectInvalidRequest("Message Catalog entries must be a string or array but was "+typeof r)},flushCache:function(){return _this.messageCatalogCache={},_this}}}]),angular.module("ngLuminateUtils").factory("$luminateRequestHandler",["$q",function(e){return{sanitizeString:function(e,n,t){var a;return a=e,t||(a=angular.element("<div>"+a+"</div>").text()),n||(a=a.replace(/\[\[/g,"").replace(/\]\]/g,"").replace(/::/g,"")),a},rejectInvalidRequest:function(n){var t;return null==n&&(n="Invalid request."),(t=e.defer()).reject(n),t.promise}}}]),angular.module("ngLuminateUtils").factory("$luminateRest",["$http","$q","$timeout","APP_INFO","$luminateUtilsConfig","$luminateRequestHandler",function(e,n,t,a,r,s){return{getAuthToken:function(e,t){var a;return!(a=this).authToken||e?(a.authTokenPending=!0,"method=getLoginUrl",a.request({api:"cons",data:"method=getLoginUrl"}).then(function(e){var t,r,s;return a.routingId=null!=(t=e.data.getLoginUrlResponse)?t.routing_id:void 0,a.jsessionId=null!=(r=e.data.getLoginUrlResponse)?r.JSESSIONID:void 0,a.authToken=(null!=(s=e.data.getLoginUrlResponse)?s.token:void 0)||"",a.authTokenPending=!1,n.resolve(a.authToken)})):(a.authTokenPending=!1,n.resolve(a.authToken))},request:function(n){var u,i,o,l,g,c,d,f,m,h,p,v;return null==n&&(n={}),u=this,i=(p=n).api,f=p.data,h=p.requiresAuth,v=p.useHTTP,"multipart/form-data"!==(null!=(o=p.contentType)?o.split(";")[0]:void 0)&&(o="application/x-www-form-urlencoded"),o+="; charset=UTF-8",r.path.nonsecure&&r.path.secure?r.apiKey?angular.isString(i)?("addressbook"!==(d=i.toLowerCase())&&"advocacy"!==d&&"cons"!==d&&"content"!==d&&"datasync"!==d&&"donation"!==d&&"group"!==d&&"orgevent"!==d&&"recurring"!==d&&"survey"!==d&&"teamraiser"!==d||(i=(i="CR"+i.toLowerCase().charAt(0).toUpperCase()+i.toLowerCase().slice(1).toLowerCase()+"API").replace("Addressbook","AddressBook").replace("Datasync","DataSync").replace("Orgevent","OrgEvent")),"CRAddressBookAPI"!==i&&"CRAdvocacyAPI"!==i&&"CRConsAPI"!==i&&"CRContentAPI"!==i&&"CRDataSyncAPI"!==i&&"CRDonationAPI"!==i&&"CRGroupAPI"!==i&&"CROrgEventAPI"!==i&&"CRRecurringAPI"!==i&&"CRSurveyAPI"!==i&&"CRTeamraiserAPI"!==i?s.rejectInvalidRequest("Invalid API servlet "+i):angular.isString(f)?(l=-1!==(f="v=1.0&response_format=json&suppress_response_codes=true&"+f+"&api_key="+r.apiKey).indexOf("&method=getLoginUrl&"),g=-1!==f.indexOf("&method=login&"),c=-1!==f.indexOf("&method=logout&"),l||u.authToken?("CRDonation"!==i&&"CRTeamraiserAPI"!==i||(v=!1),m=v?r.path.nonsecure:r.path.secure,m+=i,u.routingId&&(m+=";jsessionid="+u.routingId),r.locale&&(f+="&s_locale="+r.locale),r.defaultRequestData&&(f+="&"+r.defaultRequestData),u.jsessionId&&(f+="&JSESSIONID="+u.jsessionId),h&&(f+="&auth="+u.authToken),(null!=a?a.version:void 0)&&(f+="&ng_luminate_utils="+a.version),f+="&ts="+(new Date).getTime(),e({method:"POST",url:m,data:f,headers:{"Content-Type":o},withCredentials:!0}).then(function(e){var n;return n=e,g||c?u.getAuthToken(!0,v).then(function(){return n}):n})):u.authTokenPending?t(function(){return u.request(n)},500):u.getAuthToken(!1,v).then(function(){return u.request(n)})):s.rejectInvalidRequest("Request data must be a string but was "+typeof f)):s.rejectInvalidRequest("API servlet must be a string but was "+typeof i):s.rejectInvalidRequest("You must specify both an API Key."):s.rejectInvalidRequest("You must specify both a nonsecure and secure path.")}}}]),angular.module("ngLuminateUtils").factory("$luminateSessionVar",["$q","$luminateRequestHandler","$luminateTemplateTag",function(e,n,t){return{get:function(e){var a;return angular.isString(e)?(a="",a=0===(e=n.sanitizeString(e,!0)).indexOf("[[")&&e.lastIndexOf("]]")===e.length-2?"[[E80:"+e+"]]":"[[S80:"+e+"]]",t.parse(a).then(function(e){return n.sanitizeString(e,!0)})):n.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)},set:function(e,a){return null==a&&(a=""),angular.isString(e)?!angular.isString(a)&&isNaN(a)?n.rejectInvalidRequest("Session variable value must be a string or number but was "+typeof a):(e=n.sanitizeString(e,!0,!0),a=n.sanitizeString(a,!0),t.parse("[[U1:"+e+"="+a+"]]")):n.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)}}}]),angular.module("ngLuminateUtils").factory("$luminateTemplateTag",["$q","$luminateRequestHandler","$luminateRest",function(e,n,t){return{parse:function(a){var r;return null==a&&(a=""),angular.isString(a)?""===a?((r=e.defer()).resolve(""),r.promise):(a=n.sanitizeString(a,!0),t.request({api:"content",data:"method=getTagInfo&content="+a,requiresAuth:!0}).then(function(n){var t,a;return t=(null!=(a=n.data.getTagInfoResponse)?a.preview:void 0)||"",e.resolve(t)})):n.rejectInvalidRequest("Template tag must be a string but was "+typeof a)}}}]),angular.module("ngLuminateUtils").directive("luminateReusable",function(){return{scope:{pagename:"="},template:'<div ng-bind-html="reusableContent"></div>',replace:!0,controller:["$scope","$sce","$luminateRequestHandler","$luminateTemplateTag",function(e,n,t,a){var r;return(r=function(){var r,s;return r=e.pagename,angular.isString(r)?(s="",s=(r=t.sanitizeString(r,!0)).indexOf("[[")>-1&&r.indexOf("]]")>r.indexOf("[[")?"[[E51:"+r+"]]":"[[S51:"+(r=t.sanitizeString(r))+"]]",a.parse(s).then(function(t){return e.reusableContent=n.trustAsHtml(t)})):t.rejectInvalidRequest("Pagename must be a string but was "+typeof r)})(),e.$watch("pagename",function(e,n){if(e!==n)return r()})}]}})}).call(this);