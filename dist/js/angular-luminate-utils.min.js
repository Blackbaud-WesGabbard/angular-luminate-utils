(function(){angular.module("ngLuminateUtils",[]).constant("APP_INFO",{version:"0.3.0"}),angular.module("ngLuminateUtils").provider("$luminateUtilsConfig",function(){var e;(e=this).setPath=function(t){return null==t&&(t={}),angular.isString(t.nonsecure||!angular.isString(t.secure))?(e.path={nonsecure:t.nonsecure,secure:t.secure},e):new Error("You must specify both a nonsecure and secure path.")},e.setKey=function(t){return angular.isString(t)?(e.apiKey=t,e):new Error("API Key must be a string but was "+typeof t)},e.setDefaultRequestData=function(t){return angular.isString(t)?e.defaultRequestData=t:new Error("Request data must be a string but was "+typeof t),e},e.$get=function(){return e}}),angular.module("ngLuminateUtils").factory("$luminateRequestHandler",["$q",function(e){return{sanitizeString:function(e,t,n){var a;return a=e,n||(a=angular.element("<div>"+a+"</div>").text()),t||(a=a.replace(/\[\[/g,"").replace(/\]\]/g,"").replace(/::/g,"")),a},rejectInvalidRequest:function(t){var n;return null==t&&(t="Invalid request."),(n=e.defer()).reject(t),n.promise}}}]),angular.module("ngLuminateUtils").factory("$luminateRest",["$http","$q","$timeout","APP_INFO","$luminateUtilsConfig","$luminateRequestHandler",function(e,t,n,a,r,u){return{getAuthToken:function(e,n){var a,r;return!(a=this).authToken||e?(a.authTokenPending=!0,r="method=getLoginUrl",a.request({api:"cons",data:r}).then(function(e){var n,r,u;return a.routingId=null!=(n=e.data.getLoginUrlResponse)?n.routing_id:void 0,a.jsessionId=null!=(r=e.data.getLoginUrlResponse)?r.JSESSIONID:void 0,a.authToken=(null!=(u=e.data.getLoginUrlResponse)?u.token:void 0)||"",a.authTokenPending=!1,t.resolve(a.authToken)})):(a.authTokenPending=!1,t.resolve(a.authToken))},request:function(t){var i,s,o,l,g,c,d,m,p,f,v,h;return null==t&&(t={}),i=this,v=t,s=v.api,m=v.data,f=v.requiresAuth,h=v.useHTTP,"multipart/form-data"!==(null!=(o=v.contentType)?o.split(";")[0]:void 0)&&(o="application/x-www-form-urlencoded"),o+="; charset=UTF-8",r.path.nonsecure&&r.path.secure?r.apiKey?angular.isString(s)?("addressbook"!==(d=s.toLowerCase())&&"advocacy"!==d&&"cons"!==d&&"content"!==d&&"datasync"!==d&&"donation"!==d&&"group"!==d&&"orgevent"!==d&&"recurring"!==d&&"survey"!==d&&"teamraiser"!==d||(s=(s="CR"+s.toLowerCase().charAt(0).toUpperCase()+s.toLowerCase().slice(1).toLowerCase()+"API").replace("Addressbook","AddressBook").replace("Datasync","DataSync").replace("Orgevent","OrgEvent")),"CRAddressBookAPI"!==s&&"CRAdvocacyAPI"!==s&&"CRConsAPI"!==s&&"CRContentAPI"!==s&&"CRDataSyncAPI"!==s&&"CRDonationAPI"!==s&&"CRGroupAPI"!==s&&"CROrgEventAPI"!==s&&"CRRecurringAPI"!==s&&"CRSurveyAPI"!==s&&"CRTeamraiserAPI"!==s?u.rejectInvalidRequest("Invalid API servlet "+s):angular.isString(m)?(m="v=1.0&response_format=json&suppress_response_codes=true&"+m+"&api_key="+r.apiKey,l=-1!==m.indexOf("&method=getLoginUrl&"),g=-1!==m.indexOf("&method=login&"),c=-1!==m.indexOf("&method=logout&"),l||i.authToken?("CRDonation"!==s&&"CRTeamraiserAPI"!==s||(h=!1),p=h?r.path.nonsecure:r.path.secure,p+=s,i.routingId&&(p+=";jsessionid="+i.routingId),f&&(m+="&auth="+i.authToken),i.jsessionId&&(m+="&JSESSIONID="+i.jsessionId),r.defaultRequestData&&(m+="&"+r.defaultRequestData),(null!=a?a.version:void 0)&&(m+="&ng_luminate_utils="+a.version),m+="&ts="+(new Date).getTime(),e({method:"POST",url:p,data:m,headers:{"Content-Type":o},withCredentials:!0}).then(function(e){var t;return t=e,g||c?i.getAuthToken(!0,h).then(function(){return t}):t})):i.authTokenPending?n(function(){return i.request(t)},500):i.getAuthToken(!1,h).then(function(){return i.request(t)})):u.rejectInvalidRequest("Request data must be a string but was "+typeof m)):u.rejectInvalidRequest("API servlet must be a string but was "+typeof s):u.rejectInvalidRequest("You must specify both an API Key."):u.rejectInvalidRequest("You must specify both a nonsecure and secure path.")}}}]),angular.module("ngLuminateUtils").factory("$luminateSessionVar",["$q","$luminateRequestHandler","$luminateTemplateTag",function(e,t,n){return{get:function(e){return angular.isString(e)?(e=t.sanitizeString(e,!0,!0),n.parse("[[S80:"+e+"]]").then(function(e){return t.sanitizeString(e,!0)})):t.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)},set:function(e,a){return null==a&&(a=""),angular.isString(e)?!angular.isString(a)&&isNaN(a)?t.rejectInvalidRequest("Session variable value must be a string or number but was "+typeof a):(e=t.sanitizeString(e,!0,!0),a=t.sanitizeString(a,!0),n.parse("[[U1:"+e+"="+a+"]]")):t.rejectInvalidRequest("Session variable name must be a string but was "+typeof e)}}}]),angular.module("ngLuminateUtils").factory("$luminateTemplateTag",["$q","$luminateRequestHandler","$luminateRest",function(e,t,n){return{parse:function(a){var r;return null==a&&(a=""),angular.isString(a)?""===a?((r=e.defer()).resolve(""),r.promise):(a=t.sanitizeString(a,!0),n.request({api:"content",data:"method=getTagInfo&content="+a,requiresAuth:!0}).then(function(t){var n,a;return n=(null!=(a=t.data.getTagInfoResponse)?a.preview:void 0)||"",e.resolve(n)})):t.rejectInvalidRequest("Template tag must be a string but was "+typeof a)}}}]),angular.module("ngLuminateUtils").directive("luminateReusable",function(){return{scope:{pagename:"="},template:'<div ng-bind-html="reusableContent"></div>',replace:!0,controller:["$scope","$sce","$luminateRequestHandler","$luminateTemplateTag",function(e,t,n,a){var r;return(r=function(){var r;return r=e.pagename,angular.isString(r)?(r=angular.element("<div>"+r+"</div>").text().replace(/\[\[/g,"").replace(/\]\]/g,"").replace(/::/g,""),a.parse("[[S51:"+r+"]]").then(function(n){return e.reusableContent=t.trustAsHtml(n)})):n.rejectInvalidRequest("Pagename must be a string but was "+typeof r)})(),e.$watch("pagename",function(e,t){if(e!==t)return r()})}]}})}).call(this);