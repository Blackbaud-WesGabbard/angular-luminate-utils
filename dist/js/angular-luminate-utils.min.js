(function(){angular.module("ngLuminateUtils",[]).constant("APP_INFO",{version:"0.2.0"}),angular.module("ngLuminateUtils").provider("$luminateUtilsConfig",function(){var e;(e=this).setPath=function(t){return t.nonsecure&&t.secure?(e.path={nonsecure:t.nonsecure,secure:t.secure},e):new Error("You must specify both a nonsecure and secure path.")},e.setDefaultRequestData=function(t){return e.defaultRequestData=t,e},e.setKey=function(t){return t?(e.apiKey=t,e):new Error("You must specify an API Key.")},e.$get=function(){return e}}),angular.module("ngLuminateUtils").factory("$luminateRest",["$http","$q","$timeout","APP_INFO","$luminateUtilsConfig",function(e,t,n,r,o){return{getAuthToken:function(e,n){var r,o;return!(r=this).authToken||e?(r.authTokenPending=!0,o="method=getLoginUrl",r.request({api:"cons",data:o}).then(function(e){var n,o,a;return r.routingId=null!=(n=e.data.getLoginUrlResponse)?n.routing_id:void 0,r.jsessionId=null!=(o=e.data.getLoginUrlResponse)?o.JSESSIONID:void 0,r.authToken=(null!=(a=e.data.getLoginUrlResponse)?a.token:void 0)||"",r.authTokenPending=!1,t.resolve(r.authToken)})):(r.authTokenPending=!1,t.resolve(r.authToken))},request:function(t){var a,u,s,i,l,d,c,g,p,f,h,m;return null==t&&(t={}),a=this,h=t,u=h.api,g=h.data,f=h.requiresAuth,m=h.useHTTP,"multipart/form-data"!==(null!=(s=h.contentType)?s.split(";")[0]:void 0)&&(s="application/x-www-form-urlencoded"),s+="; charset=UTF-8",u?("addressbook"!==(c=u.toLowerCase())&&"advocacy"!==c&&"cons"!==c&&"content"!==c&&"datasync"!==c&&"donation"!==c&&"group"!==c&&"orgevent"!==c&&"recurring"!==c&&"survey"!==c&&"teamraiser"!==c||(u=(u="CR"+u.toLowerCase().charAt(0).toUpperCase()+u.toLowerCase().slice(1).toLowerCase()+"API").replace("Addressbook","AddressBook").replace("Datasync","DataSync").replace("Orgevent","OrgEvent")),"CRAddressBookAPI"!==u&&"CRAdvocacyAPI"!==u&&"CRConsAPI"!==u&&"CRContentAPI"!==u&&"CRDataSyncAPI"!==u&&"CRDonationAPI"!==u&&"CRGroupAPI"!==u&&"CROrgEventAPI"!==u&&"CRRecurringAPI"!==u&&"CRSurveyAPI"!==u&&"CRTeamraiserAPI"!==u?new Error("Invalid API servlet."):g?(g="v=1.0&response_format=json&suppress_response_codes=true&"+g+"&api_key="+o.apiKey,i=-1!==g.indexOf("&method=getLoginUrl&"),l=-1!==g.indexOf("&method=login&"),d=-1!==g.indexOf("&method=logout&"),i||a.authToken?("CRDonation"!==u&&"CRTeamraiserAPI"!==u||(m=!1),p=m?o.path.nonsecure:o.path.secure,p+=u,a.routingId&&(p+=";jsessionid="+a.routingId),f&&(g+="&auth="+a.authToken),a.jsessionId&&(g+="&JSESSIONID="+a.jsessionId),o.defaultRequestData&&(g+="&"+o.defaultRequestData),(null!=r?r.version:void 0)&&(g+="&ng_luminate_utils="+r.version),g+="&ts="+(new Date).getTime(),e({method:"POST",url:p,data:g,headers:{"Content-Type":s},withCredentials:!0}).then(function(e){var t;return t=e,l||d?a.getAuthToken(!0,m).then(function(){return t}):t})):a.authTokenPending?n(function(){return a.request(t)},500):a.getAuthToken(!1,m).then(function(){return a.request(t)})):new Error("You must specify request data.")):new Error("You must specify an API servlet.")}}}]),angular.module("ngLuminateUtils").factory("$luminateSessionVar",["$q","$luminateTemplateTag",function(e,t){return{get:function(e){return t.parse("[[S80:"+e+"]]")},set:function(e,n){return t.parse("[[U1:"+e+"="+n+"]]")}}}]),angular.module("ngLuminateUtils").factory("$luminateTemplateTag",["$q","$luminateRest",function(e,t){return{parse:function(n){var r;return n?t.request({api:"content",data:"method=getTagInfo&content="+n,requiresAuth:!0}).then(function(t){var n,r;return n=(null!=(r=t.data.getTagInfoResponse)?r.preview:void 0)||"",e.resolve(n)}):((r=e.defer()).resolve(""),r.promise)}}}])}).call(this);